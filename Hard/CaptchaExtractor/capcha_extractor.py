import numpy
from PIL import Image, ImageEnhance, ImageFilter
import pytesseract
from scipy.ndimage.filters import gaussian_filter
from operator import itemgetter

if __name__ == '__main__':
    pytesseract.pytesseract.tesseract_cmd = "D:\\Soft\\Tessaract\\tesseract.exe"

    th1 = 220
    th2 = 250
    sig = 1.0

    original_image = Image.open("simple_capt.png")
    brightness_enhancer = ImageEnhance.Brightness(original_image)
    bright_image = brightness_enhancer.enhance(12)

    his = bright_image.histogram()

    values = {}

    # for i in range(256): This code is for identifying the color values in the image
    #     values[i] = his[i]
    #
    # for j, k in sorted(values.items(), key=itemgetter(1), reverse=True)[:10]:
    #     print(j, k)

    converter = ImageEnhance.Color(bright_image)
    img2 = converter.enhance(10)

    black_and_white = img2.convert("L")
    first_threshold = black_and_white.point(lambda p: p > th1 and 255)

    blur = numpy.array(first_threshold)

    blurred = gaussian_filter(blur, sigma=sig)

    blurred = Image.fromarray(blurred)

    final = blurred.point(lambda p: p > th2 and 255)

    final = final.filter(ImageFilter.EDGE_ENHANCE_MORE)

    final = final.filter(ImageFilter.SHARPEN)

    final.show()

    number = pytesseract.image_to_string(final)

    print(number)

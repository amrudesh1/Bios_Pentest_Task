import numpy
from PIL import Image, ImageFilter
import pytesseract
from scipy.ndimage.filters import gaussian_filter
import re
import operator


def pre_process_image(image):
    black_and_white = original_image.convert("L")
    first_threshold = black_and_white.point(lambda p: p > th1 and 255)
    blur = numpy.array(first_threshold)
    blurred = gaussian_filter(blur, sigma=sig)
    blurred = Image.fromarray(blurred)
    final = blurred.point(lambda p: p > th2 and 255)
    final = final.filter(ImageFilter.EDGE_ENHANCE_MORE)
    final = final.filter(ImageFilter.SHARPEN)
    return pytesseract.image_to_string(final)


if __name__ == '__main__':
    pytesseract.pytesseract.tesseract_cmd = "D:\\Soft\\Tessaract\\tesseract.exe"

    th1 = 150
    th2 = 200
    sig = 1.0

    original_image = Image.open("operator.png")
    processed_string = pre_process_image(original_image)
    print("{}={}".format(processed_string, eval(processed_string)))

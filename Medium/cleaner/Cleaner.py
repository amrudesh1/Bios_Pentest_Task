import download_folder
import os
import datetime as dt
import calendar
import shutil

if __name__ == '__main__':
    year = []
    file_name_date = {}
    directory = download_folder.get_download_folder()
    file_list = os.listdir(directory)
    print(directory)
    for file in file_list:
        file_name = directory + "/" + file
        if dt.datetime.fromtimestamp(os.path.getctime(file_name)).year not in year:
            year.append(dt.datetime.fromtimestamp(os.path.getctime(file_name)).year)
        file_name_date[file] = str(dt.datetime.fromtimestamp(os.path.getctime(file_name)).date())

    print(file_name_date)
    for k in file_name_date.keys():
        for y in year:
            if str(k) == str(y):
                file_name_date.popitem()

    for date_folder in list(set(file_name_date.values())):
        print(date_folder)
        currentMonth = dt.datetime.strptime(date_folder, '%Y-%m-%d')
        month_folder_path = directory + "/" + str(calendar.month_name[currentMonth.month])
        file_path = directory + "/" + str(calendar.month_name[currentMonth.month]) + "/" + date_folder
        if os.path.exists(month_folder_path):
            if not os.path.exists(file_path):
                os.mkdir(file_path)
        else:
            os.mkdir(month_folder_path)
            os.mkdir(file_path)

    # Copy files to respective folders

    for file_name, file_date in file_name_date.items():
        currentMonth = dt.datetime.strptime(file_date, '%Y-%m-%d')
        copy_file_path = directory + "/" + str(calendar.month_name[currentMonth.month]) + "/" + file_date
        file_path = directory + "/" + file_name
        currentPath = directory + "/" + str(calendar.month_name[currentMonth.month])
        if os.path.exists(copy_file_path):
            if not file_path == currentPath:
                shutil.move(file_path, copy_file_path)

    year.sort()

    if dt.datetime.now().year > year[-1]:
        file_name_date.clear()
        for y in year:
            if os.path.exists(directory + "/" + year):
                file_list = os.listdir(directory)
                for files in file_list:
                    file_name = directory + "/" + files
                    file_name_date[files] = str(dt.datetime.fromtimestamp(os.path.getctime(file_name)).date())

    # Copying file to folder on new year is pending

from multiprocessing.connection import Listener
from AESEncrypt import Encryptor

if __name__ == '__main__':
    key = '[EX\xc8\xd5\xbfI{\xa2$\x05(\xd5\x18\xbf\xc0\x85)\x10nc\x94\x02)j\xdf\xcb\xc4\x94\x9d(\x9e'
    enc = Encryptor(key)

    address = ('localhost', 6000)  # family is deduced to be 'AF_INET'
    listener = Listener(address, authkey=str.encode('secret password'))
    conn = listener.accept()
    print('connection accepted from', listener.last_accepted)
    while True:
        msg = conn.recv()
        if msg:
            print(enc.decrypt_msg(msg))
        try:
            message = str(input())
            if str(message):
                conn.send(enc.encrypt_msg(message))
        except KeyboardInterrupt:
            conn.close()
            listener.close()